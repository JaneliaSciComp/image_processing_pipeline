{% extends "branding.html" %}
{% block content %}
  <!--
      Rows to configure a new job
  -->
  <div class="row lightsheet-row">
    <h4>Configure Job</h4>
  </div>
  <div class="row">
    <div class="col-lg-9 col-md-9 col-sm-9">
      <div class="form-group form-inline">
        <label class="lightsheet-label">Name: </label>
        <input type="text" class="form-control lightsheet-input" name="job-name">
      </div>
      <div class="form-group form-inline">
        <label class="lightsheet-label">Date: </label>
        <input type="text" id="datepicker" class="pika-datepicker">
      </div>
      <div class="form-group form-inline">
        <label class="lightsheet-label">Select Job: </label>
        <select class="form-control" onchange="location = this.options[this.selectedIndex].value;">
          <option value="{{ url_for('index') }}" selected>---Select Previous Run---</option>
            {% if parentServiceData is not none %}
              {% for service in parentServiceData %}
                <option value={{ url_for('index', jacsServiceIndex=service.index) }} {{ service.selected }}>
                  {% if 'creationDate' in service and 'args' in service and service.args|length > 3 %}
                    {{ service.creationDate | strftime + " " + "(" + service.args[3] + ")"}}
                  {% else %}
                    job {{ loop.index }}
                  {% endif %}
                </option>
              {% endfor %}
            {% endif %}
        </select>
      </div>
    </div>
  </div>
  <!--
    Accordeon control which contains the steps
  -->
  <form action="" method="post">
    <div class="row lightsheet-row">
      <div id="steps">
         {% for step in config['steps'] %}
            {% if pipelineSteps is defined and pipelineSteps[step.name] is defined and pipelineSteps[step.name] is not none %}
               {% set pipelineStep = pipelineSteps[step.name] %}
               {% include "stepLoadJob.html" ignore missing with context %}
            {% else %}
               {% include "stepDefault.html" ignore missing with context %}
            {%  endif %}
         {% endfor %}
      </div>
    </div>
    <!-- button to submit the forms -->
    <div class="row lightsheet-row">
      <input type="submit" name="postJob" class="btn btn-info" value="Submit Job" /></p>
    </div>
  </form>
  <!--
      Rows to select an existing job
  -->
  <div class="row lightsheet-row" style="margin-top: 2em;">
    <h4>Previous Jobs</h4>
  </div>
  <div class="row lightsheet-row">
    <input class="form-control lightsheet-search" type="text" placeholder="Search for names.." id="search-input" onkeyup="lightsheet.filterTable()">
    <table class="table table-striped table-hover" id="job-table">
      <thead>
        <tr>
          <th onclick="lightsheet.sortTable(0)"></th>
          <th onclick="lightsheet.sortTable(1)">Name</th>
          <th onclick="lightsheet.sortTable(2)">Date</th>
          <th onclick="lightsheet.sortTable(3)">Steps</th>
          <th onclick="lightsheet.sortTable(4)">InputFolder</th>
        </tr>
      </thead>
      <tbody id="job-table-body">
        {% if parentServiceData is not none %}
          {% for service in parentServiceData %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>Name</td>
              {% if 'creationDate' in service and service.creationDate is not none %}
                <td> {{ service.creationDate }}</td>
              {% else %}
                <td>N/A</td>
              {% endif %}
              {% if 'args' in service and service.args|length > 3 %}
                <td>{{ service.args[3]}}</td>
              {% else %}
                <td>N/A</td>
              {% endif %}
              {% if 'args' in service and service.args|length > 2 %}
                <td>{{ service.args[1]}}</td>
              {% else %}
                <td>N/A</td>
              {% endif %}
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
  <script src="{{url_for('static', filename='js/landing.js')}}"></script>
  <!-- contrib dependencies -->
  <script src="{{url_for('static', filename='components/moment/min/moment.min.js')}}"></script>
  <script>
    $(document).ready(function(){
      var picker = new Pikaday({ field: document.getElementById('datepicker') });
      var myJobIndex = null;
      {% if jobIndex is defined and jobIndex is not none %}
        myJobIndex = "{{ jobIndex|safe }}";
      {% endif %}
      if (myJobIndex !== null) {
        lightsheet.stepsExistingJob();
      }
    })
  </script>

{% endblock %}
