{% extends "branding.html" %}
{% block content %}
  <style>
  .alert {
      padding: 20px;
      background-color: #f44336;
      color: white;
      opacity: 1;
      transition: opacity 0.6s;
      margin-bottom: 15px;
  }

  .alert.success {background-color: #4CAF50;}
  .alert.info {background-color: #2196F3;}
  .alert.warning {background-color: #ff9800;}

  .closebtn {
     margin-left: 15px;
     color: white;
     font-weight: bold;
     float: right;
     font-size: 22px;
     line-height: 20px;
     cursor: pointer;
     transition: 0.3s;
  }

  .closebtn:hover {
     color: black;
  }
  </style>
  {% if submissionStatus is not none %}
    {% if submissionStatus == "success" %}
      <div class="alert successf">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
        <strong>Job submission successful!</strong>
      </div>
    {% else %}
     <div class="alert">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
        <strong>Submission failed with error:</strong> {{ errorMessage }}.
      </div>
    {% endif %}
  {% endif %}
  <!--
      Rows to configure a new job
  -->
  <div class="row lightsheet-row">
    <h4>Configure Job</h4>
  </div>
  <div class="row">
    <div class="col-lg-3 col-md-3 col-sm-3">
      <div class="form-group form-inline">
        <label class="lightsheet-label">Name: </label>
        <input type="text" class="form-control lightsheet-input" name="job-name">
      </div>
      <div class="form-group form-inline">
        <label class="lightsheet-label">Date: </label>
        <input type="text" id="datepicker" class="pika-datepicker">
      </div>
    </div>
    <div class="col-lg-6 col-md-6 col-sm-6">
      <select class="form-control select-job" onchange="location = this.options[this.selectedIndex].value;">
        <option value="{{ url_for('index') }}" selected>---Select Previous Run---</option>
          {% if parentJobInfo is not none %}
            {% for currentJobInfo in parentJobInfo %}
              <option value={{ url_for('index', lightsheetDB_id=currentJobInfo._id) }} {{ currentJobInfo.selected }}>
                {% if 'creationDate' in currentJobInfo and 'selectedStepNames' in currentJobInfo%}
                  {{ currentJobInfo.creationDate | strftime + " " + "(" + currentJobInfo.selectedStepNames + ")"}}
                {% else %}
                  job {{ loop.index }}
                {% endif %}
              </option>
            {% endfor %}
          {% endif %}
      </select>
    </div>
  </div>
  <!--
    Accordeon control which contains the steps
  -->
  <form action="" method="post">
    <div class="row lightsheet-row">
      <div id="steps">
        {% for step in config['steps'] %}
          {% if pipelineSteps is defined and pipelineSteps[step.name] is defined and pipelineSteps[step.name] is not none %}
            {% set pipelineStep = pipelineSteps[step.name] %}
            {% include "stepLoadJob.html" ignore missing with context %}
          {% else %}
            {% include "stepDefault.html" ignore missing with context %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
    <!-- button to submit the forms -->
    <div class="row lightsheet-row">
      <input type="submit" name="postJob" class="btn btn-info" value="Submit Job"/></p>
    </div>
  </form>
  <!--
      Rows to select an existing job
  -->
  <div class="row lightsheet-row" style="margin-top: 2em;">
    <h4>Previous Jobs</h4>
  </div>
  <div class="row lightsheet-row">
    <input class="form-control lightsheet-search" type="text" placeholder="Search for names.." id="search-input"
           onkeyup="lightsheet.filterTable()">
    {% include "jobs.html" ignore missing with context %}
  </div>
  <script src="{{ url_for('static', filename='js/landing.js') }}"></script>
  <!-- contrib dependencies -->
  <script src="{{ url_for('static', filename='components/moment/min/moment.min.js') }}"></script>
  <script>
    $(document).ready(function () {
      var picker = new Pikaday({field: document.getElementById('datepicker')});
      var myJobIndex = null;
      {% if lightsheetDB_id is defined and jobIndex is not none %}
        myJobIndex = "{{ lightsheetDB_id|safe }}";
      {% endif %}
      if (myJobIndex !== null) {
        lightsheet.stepsExistingJob();
      }
    })
  </script>

{% endblock %}
