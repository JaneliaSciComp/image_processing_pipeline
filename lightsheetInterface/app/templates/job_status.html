{% extends "branding.html" %}
{% block content %}
  <style>
  </style>
  <div class="row lightsheet-row">
    <h3>Job Status</h3>
  </div>
  <div class="row lightsheet-row">
    <!-- Drop down menu to look up status of previous jobs, colorcoded by status of job -->
    <META HTTP-EQUIV="refresh" CONTENT="30">
    <select class="form-control lightsheet-dropdown" onchange="location = this.options[this.selectedIndex].value;">
      <option value="{{ url_for('job_status') }}" selected>---Select Previous Run---</option>
      {% if parentJobInfo is not none %}
        {% for currentJobInfo in parentJobInfo %}
          {% if currentJobInfo.state == "ERROR" %}
            <option class="status-error" value={{ url_for('job_status', lightsheetDB_id=currentJobInfo._id )}}
              {{ currentJobInfo.selected }}>  {{   currentJobInfo.creationDate | strftime + " " + "(" + currentJobInfo.selectedStepNames + ")"}}
            </option>
          {% endif %}
          {% if currentJobInfo.state == "SUCCESSFUL" %}
            <option class="status-successful" value={{ url_for('job_status', lightsheetDB_id=currentJobInfo._id )}}
              {{ currentJobInfo.selected }}>  {{ currentJobInfo.creationDate | strftime + " " + "(" + currentJobInfo.selectedStepNames + ")"}}
            </option>
          {% endif %}
          {% if currentJobInfo.state == "RUNNING" %}
            <option class="status-running" value={{ url_for('job_status', lightsheetDB_id=currentJobInfo._id )}}
              {{ currentJobInfo.selected }}>  {{ currentJobInfo.creationDate | strftime + " " + "(" + currentJobInfo.selectedStepNames + ")"}}
            </option>
          {% endif %}
        {% endfor %}
      {% endif %}
    </select>
  </div>
  <div class="row lightsheet-row">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Step</th>
          <th>Status</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Elapsed Time</th>
          <th>Log Directory Download</th>
        </tr>
      <thead>
      <tbody>
        <!-- Status of child processes-->
        {% if childJobInfo is not none %}
          {% for currentChildJob in childJobInfo %}
            <tr>
              <td>{{ currentChildJob.name }}</td>
              <td>{{ currentChildJob.state }}</td>
              <td>{{ currentChildJob.creationTime }}</td>
              <td>{{ currentChildJob.endTime }}</td>
              <td>{{ currentChildJob.elapsedTime }}</td>
              <td><a href= {{"http://c03u14.int.janelia.org:9881/jacsstorage/agent_api/v1/agent_storage/storage_path"+currentChildJob.logAndErrorPath +"/sge_error/" }}>Download Error Directory</a></td>
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
